<script type="module">
    const SUPABASE_URL = 'https://gltwltqldfoksylzayvs.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_cuF14kK1aF-DAduO-r1DPg_CGjpZbuT'; 
    const EDGE_URL = 'https://gltwltqldfoksylzayvs.supabase.co/functions/v1/search-flights'; 

    window.searchFlights = async () => {
        const payload = {
            region_name: document.getElementById('region').value,
            destination_home: document.getElementById('destination').value.toUpperCase(),
            departure_date: document.getElementById('date').value,
            adults: parseInt(document.getElementById('adults').value),
            children: parseInt(document.getElementById('children').value),
            infants: parseInt(document.getElementById('infants').value),
            nonStop: document.getElementById('nonStop').checked
        };

        try {
            const res = await fetch(EDGE_URL, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`
                },
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            renderResults(data);
        } catch (e) { console.error(e); }
    };
</script>

